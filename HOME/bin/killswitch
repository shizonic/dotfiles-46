#!/bin/bash

iptables -F
iptables -X
iptables -Z

cat << EOF | iptables-restore
*mangle
:PREROUTING ACCEPT [0:0]
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
:POSTROUTING ACCEPT [0:0]
COMMIT

*nat
:PREROUTING ACCEPT [0:0]
:INPUT ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
:POSTROUTING ACCEPT [0:0]
COMMIT

# Set a default DROP policy.
*filter
:INPUT DROP [0:0]
:FORWARD DROP [0:0]
:OUTPUT DROP [0:0]

# Allow basic INPUT traffic.
-A INPUT -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A INPUT -i lo -j ACCEPT
-A INPUT -p icmp --icmp-type 8 -m conntrack --ctstate NEW -j ACCEPT

# Allow basic OUTPUT traffic.
-A OUTPUT -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A OUTPUT -o lo -j ACCEPT
-A OUTPUT -p icmp -j ACCEPT

# Allow traffic to the OpenVPN server and via the tunnel.
-A OUTPUT -o tun+ -j ACCEPT

#mullvad_se
-A OUTPUT -p udp -m udp -d 185.213.154.131 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 185.213.154.132 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 185.213.154.133 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 185.213.154.134 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 185.213.154.135 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 185.213.154.136 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 185.213.154.137 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 185.213.154.138 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 185.213.154.139 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 185.213.154.140 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 185.213.154.141 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 185.213.154.142 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 185.213.152.131 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 185.213.152.132 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 185.213.152.133 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 185.213.152.134 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 185.213.152.137 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 185.213.152.138 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 193.138.218.131 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 193.138.218.132 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 193.138.218.133 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 193.138.218.134 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 193.138.218.135 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 141.98.255.83 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 141.98.255.85 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 141.98.255.87 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 141.98.255.88 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 141.98.255.90 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 141.98.255.91 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 141.98.255.92 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 141.98.255.93 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 185.65.135.131 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 185.65.135.132 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 185.65.135.133 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 185.65.135.134 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 185.65.135.135 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 185.65.135.136 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 185.65.135.137 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 185.65.135.138 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 185.65.135.139 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 185.65.135.140 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 185.65.135.141 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 185.65.135.142 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 185.65.135.143 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 185.65.135.144 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 185.65.135.145 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 185.65.135.146 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 185.65.135.147 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 185.65.135.148 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 185.65.135.149 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 185.65.135.150 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 185.65.135.151 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 185.65.135.152 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 185.65.135.153 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 185.65.135.154 --dport 1195 -j ACCEPT
-A OUTPUT -p udp -m udp -d 185.65.135.155 --dport 1195 -j ACCEPT

# Reject everything else.
-A INPUT -m conntrack --ctstate INVALID -j DROP
-A INPUT -j REJECT --reject-with icmp-port-unreachable
-A FORWARD -j REJECT --reject-with icmp-port-unreachable
-A OUTPUT -j REJECT --reject-with icmp-port-unreachable
COMMIT
EOF

ip6tables -F
ip6tables -X
ip6tables -Z
ip6tables -P INPUT DROP
ip6tables -P FORWARD DROP
ip6tables -P OUTPUT DROP
